<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Invest User</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #f0f2f5; display: flex; justify-content: center; min-height: 100vh; }
        
        .app-container { width: 100%; max-width: 480px; background: white; height: 100vh; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        
        .auth-screen { position: absolute; top:0; left:0; width:100%; height:100%; background:white; z-index:1000; display:flex; flex-direction:column; justify-content:center; padding:30px; }
        .hidden { display: none !important; }
        
        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .modal-box { background: white; width: 90%; max-width: 400px; padding: 20px; border-radius: 15px; text-align: center; position: relative; animation: popUp 0.3s; }
        @keyframes popUp { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        .detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; font-size: 15px; }

        /* Main Styles */
        .header { background: #6c5ce7; padding: 15px 20px; color: white; display: flex; justify-content: space-between; align-items: center; }
        .content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 15px; border: 1px solid #f1f2f6; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin: 8px 0; font-size: 16px; outline: none; background: #f9f9f9; }
        button { width: 100%; padding: 12px; border: none; background: #6c5ce7; color: white; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        
        /* Plan Card */
        .plan-card { display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #ffffff 0%, #f3f0ff 100%); border: 1px solid #e0d4fc; padding: 15px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; }
        .plan-card:active { transform: scale(0.98); }

        .history-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; font-size: 14px; }
        .status-pending { color: orange; font-weight:bold; }
        .status-approved { color: green; font-weight:bold; }
        .status-rejected { color: red; font-weight:bold; }

        /* Referral Box Styles */
        .ref-box { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; text-align: center; }
        .ref-locked { background: #bdc3c7; color: #7f8c8d; text-align: center; opacity: 0.8; }
        .ref-code-display { background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }

        .nav { position: absolute; bottom: 0; width: 100%; height: 70px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 500; }
        .nav-item { text-align: center; color: #95a5a6; font-size: 11px; width: 100%; padding: 10px; }
        .nav-item.active { color: #6c5ce7; font-weight: bold; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- Login Screen -->
    <div id="login-screen" class="auth-screen">
        <h2 style="text-align:center; color:#6c5ce7;">‡¶≤‡¶ó‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <input type="number" id="log-phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞">
        <input type="password" id="log-pass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
        <button onclick="loginUser()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <p style="text-align:center; margin-top:20px;">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á? <a href="#" onclick="showRegister()" style="color:#6c5ce7; font-weight:bold;">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
    </div>

    <!-- Register Screen -->
    <div id="register-screen" class="auth-screen hidden">
        <h2 style="text-align:center; color:#6c5ce7;">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</h2>
        <input type="text" id="reg-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="number" id="reg-phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞">
        <input type="email" id="reg-email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏">
        <input type="password" id="reg-pass" placeholder="‡¶ó‡ßã‡¶™‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
        <input type="number" id="reg-ref" placeholder="‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá)">
        <button onclick="registerUser()">‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</button>
        <p style="text-align:center; margin-top:20px;">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? <a href="#" onclick="showLogin()" style="color:#6c5ce7; font-weight:bold;">‡¶≤‡¶ó‡¶ø‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a></p>
    </div>

    <!-- PLAN DETAILS MODAL -->
    <div id="plan-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:#6c5ce7; margin-bottom:15px;">‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏</h3>
            <div class="detail-row"><span>‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü:</span><span id="m-price" style="font-weight:bold;">0</span></div>
            <div class="detail-row"><span>‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶™‡ßç‡¶∞‡¶´‡¶ø‡¶ü:</span><span id="m-daily" style="font-weight:bold; color:green;">0</span></div>
            <div class="detail-row"><span>‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ (Duration):</span><span>‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®</span></div>
            
            <!-- Double Return Info -->
            <div class="detail-row" style="background:#e8f6ef; padding:8px; border-radius:5px; border:1px solid #2ecc71;">
                <span>‡ß©‡ß¶ ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞ ‡¶´‡ßá‡¶∞‡¶§:</span>
                <span style="color:green; font-weight:bold;">‡ß® ‡¶ó‡ßÅ‡¶® (Double)</span>
            </div>
            <p style="font-size:11px; color:#e74c3c; margin-top:5px;">‡¶ü‡¶æ‡¶ï‡¶æ ‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡¶ï ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§</p>
            
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button onclick="closeModal()" style="background:#e74c3c;">Cancel</button>
                <button onclick="confirmBuy()" style="background:#27ae60;">Confirm Invest</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden" style="height: 100%; flex-direction: column;">
        <div class="header">
            <div><small>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</small><h2 id="header-balance">‚Çπ 0</h2></div>
            <div id="status-badge" style="background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 20px; font-size: 11px;">Unverified</div>
        </div>

        <div class="content">
            <!-- Home -->
            <div id="home" class="page active">
                <div class="card" style="background: #fff8e1; border: 1px solid #ffe082; display: flex; justify-content: space-between; align-items: center;">
                    <div><h4 style="color: #f39c12; margin:0;">‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</h4><small>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶® ‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</small></div>
                    <button onclick="claimBonus()" style="width: auto; background: #f39c12; padding: 5px 15px; color: white; border-radius:20px;">Claim</button>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                    <div onclick="navTo('deposit')" class="card" style="text-align: center; background: #e8f6ef; border: 1px solid #2ecc71; color: #27ae60; cursor:pointer;">
                        <i class="fas fa-plus-circle" style="font-size: 24px;"></i><br>‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü
                    </div>
                    <div onclick="navTo('withdraw')" class="card" style="text-align: center; background: #ffebee; border: 1px solid #e74c3c; color: #c0392b; cursor:pointer;">
                        <i class="fas fa-download" style="font-size: 24px;"></i><br>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®
                    </div>
                </div>
                <h4>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶á‡¶®‡¶≠‡ßá‡¶∏‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h4>
                <div id="active-investments"><p style="text-align:center; color:#aaa;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡ßá‡¶®‡¶æ ‡¶®‡ßá‡¶á</p></div>
            </div>

            <!-- Deposit -->
            <div id="deposit" class="page">
                <h3>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card">
                    <p style="font-size:13px; color:#555; margin-bottom:10px;">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡ßß‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ‡•§ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶¨‡ßá‡•§</p>
                    <input type="number" id="dep-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£">
                    <button onclick="payNow()" style="background: #27ae60; margin-bottom: 10px;">Pay with UPI</button>
                    <input type="text" id="dep-utr" placeholder="UTR Number ‡¶¶‡¶ø‡¶®">
                    <button onclick="submitDeposit()" style="background: #34495e;">Submit</button>
                </div>
            </div>

            <!-- Withdraw -->
            <div id="withdraw" class="page">
                <h3>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h3>
                <div class="card">
                    <div style="text-align:center; margin-bottom:10px; border-bottom:1px solid #eee;">
                        <small>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</small>
                        <h1 id="with-bal" style="color:#e74c3c;">‚Çπ 0</h1>
                    </div>
                    <label style="font-size:12px; font-weight:bold;">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                    <input type="number" id="with-amount" placeholder="Minimum ‚Çπ100">
                    <label style="font-size:12px; font-weight:bold;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ UPI ID</label>
                    <input type="text" id="with-upi" placeholder="example@upi">
                    <button onclick="submitWithdraw()" style="background: #e74c3c; margin-top:10px;">
                        <i class="fas fa-paper-plane"></i> ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                    </button>
                </div>
                <h4>‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h4>
                <div class="card" id="withdraw-history">
                    <p style="text-align:center; color:#aaa;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                </div>
            </div>

            <!-- Invest -->
            <div id="invest" class="page">
                <h3 style="margin-bottom:10px;">‡¶≠‡¶ø‡¶Ü‡¶á‡¶™‡¶ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡¶∏</h3>
                <div id="plans-container"></div>
            </div>

            <!-- Profile (With Support) -->
            <div id="profile" class="page">
                <div class="card" style="text-align: center;">
                    <i class="fas fa-user-circle" style="font-size: 60px; color: #ddd;"></i>
                    <h3 id="profile-name" style="margin-top: 10px;">User</h3>
                    <p id="profile-phone">...</p>
                    <button onclick="location.reload()" style="background: #636e72; margin-top: 10px; width:auto; padding:5px 20px;">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
                </div>
                
                <!-- SUPPORT SYSTEM -->
                <div class="card">
                    <h4 style="margin-bottom:10px; color:#2d3436;">‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶≤‡¶æ‡¶á‡¶® & ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h4>
                    <p style="font-size:12px; color:#7f8c8d; margin-bottom:10px;">‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="openSupport('wa')" style="background: #25D366; flex:1;">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        <button onclick="openSupport('tg')" style="background: #0088cc; flex:1;">
                            <i class="fab fa-telegram-plane"></i> Telegram
                        </button>
                    </div>
                </div>

                <!-- REFERRAL SECTION (LOCKED) -->
                <div id="ref-locked-view" class="card ref-locked">
                    <i class="fas fa-lock" style="font-size:30px; margin-bottom:10px;"></i>
                    <h3>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶Ü‡¶õ‡ßá</h3>
                    <p style="font-size:13px; margin-top:5px;">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</p>
                </div>

                <!-- REFERRAL SECTION (UNLOCKED) -->
                <div id="ref-unlocked-view" class="card ref-box hidden">
                    <h3>üì¢ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <p style="font-size:13px; margin-top:5px; opacity:0.9;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡ßß‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá <b>‡ß®‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</b> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®!</p>
                    <div class="ref-code-display" onclick="copyRef()">
                        <span id="my-ref-code" style="font-weight:bold;">Loading...</span>
                        <i class="fas fa-copy"></i>
                    </div>
                    <small style="display:block; margin-top:5px;">‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</small>
                </div>
            </div>
        </div>

        <div class="nav">
            <div class="nav-item active" onclick="navTo('home', this)"><i class="fas fa-home"></i>Home</div>
            <div class="nav-item" onclick="navTo('deposit', this)"><i class="fas fa-wallet"></i>Wallet</div>
            <div class="nav-item" onclick="navTo('invest', this)"><i class="fas fa-chart-line"></i>Invest</div>
            <div class="nav-item" onclick="navTo('profile', this)"><i class="fas fa-user"></i>Profile</div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update, push, get, runTransaction } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC_7lvHpyLYGCd0EO9YsyM_4U-GnACA3pg",
      authDomain: "smart-invest-money.firebaseapp.com",
      databaseURL: "https://smart-invest-money-default-rtdb.firebaseio.com",
      projectId: "smart-invest-money",
      storageBucket: "smart-invest-money.firebasestorage.app",
      messagingSenderId: "706922742654",
      appId: "1:706922742654:web:90d1987ceeca88a16de92f",
      measurementId: "G-3H816FZ73F"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let currentUser = null;
    let userData = {};
    let selectedPlan = null;

    window.showRegister = () => { document.getElementById('login-screen').classList.add('hidden'); document.getElementById('register-screen').classList.remove('hidden'); }
    window.showLogin = () => { document.getElementById('register-screen').classList.add('hidden'); document.getElementById('login-screen').classList.remove('hidden'); }

    // Register with Referral Logic
    window.registerUser = async function() {
        const name = document.getElementById('reg-name').value;
        const phone = document.getElementById('reg-phone').value;
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;
        const refCode = document.getElementById('reg-ref').value;

        if(!name || !phone || !pass) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
        
        let referrer = "";
        if(refCode) {
            const refSnap = await get(ref(db, 'users/' + refCode));
            if(refSnap.exists()) { referrer = refCode; } 
            else { return alert("‡¶≠‡ßÅ‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°!"); }
        }

        await set(ref(db, 'users/' + phone), { 
            name, phone, email, password: pass, balance: 0, 
            hasDeposited: false, referrer: referrer, referralBonusPaid: false 
        });
        
        alert("‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶∏‡¶´‡¶≤!"); showLogin();
    }

    window.loginUser = async function() {
        const phone = document.getElementById('log-phone').value;
        const pass = document.getElementById('log-pass').value;
        const snap = await get(ref(db, 'users/' + phone));
        
        if(snap.exists() && snap.val().password == pass) {
            currentUser = phone;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('main-app').style.display = 'flex';
            startLiveUpdates(phone);
            renderPlans();
        } else { alert("‡¶≠‡ßÅ‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø!"); }
    }

    function startLiveUpdates(phone) {
        onValue(ref(db, 'users/' + phone), (snap) => {
            userData = snap.val();
            document.getElementById('header-balance').innerText = "‚Çπ " + userData.balance;
            document.getElementById('with-bal').innerText = "‚Çπ " + userData.balance;
            document.getElementById('profile-name').innerText = userData.name;
            document.getElementById('profile-phone').innerText = userData.phone;
            document.getElementById('my-ref-code').innerText = userData.phone; 

            // LOGIC FOR DEPOSIT VERIFICATION & UNLOCKING FEATURES
            if(userData.hasDeposited) {
                document.getElementById('status-badge').innerText = "Verified";
                document.getElementById('status-badge').style.background = "#2ecc71";
                
                // Unlock Referral Section
                document.getElementById('ref-locked-view').classList.add('hidden');
                document.getElementById('ref-unlocked-view').classList.remove('hidden');

                // Instant Referral Bonus Check for the Referrer
                if(userData.referrer && userData.referralBonusPaid === false) {
                    processReferralReward(userData.referrer, phone);
                }
            } else {
                // Ensure Referral is Locked
                document.getElementById('ref-locked-view').classList.remove('hidden');
                document.getElementById('ref-unlocked-view').classList.add('hidden');
            }

            loadInvestments(userData.investments);
        });

        onValue(ref(db, 'withdrawals'), (snap) => {
            const list = document.getElementById('withdraw-history');
            list.innerHTML = "";
            if(snap.exists()){
                snap.forEach(child => {
                    const d = child.val();
                    if(d.user === currentUser) {
                        let statusClass = d.status === 'pending' ? 'status-pending' : (d.status === 'approved' ? 'status-approved' : 'status-rejected');
                        list.innerHTML += `<div class="history-item"><div><b>‚Çπ${d.amount}</b><br><small>To: ${d.upi}</small></div><div class="${statusClass}">${d.status}</div></div>`;
                    }
                });
            } else { list.innerHTML = "<p style='text-align:center;'>‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶® ‡¶®‡ßá‡¶á</p>"; }
        });
    }

    async function processReferralReward(referrerPhone, newUserId) {
        await update(ref(db, 'users/' + newUserId), { referralBonusPaid: true });
        const referrerRef = ref(db, 'users/' + referrerPhone + '/balance');
        runTransaction(referrerRef, (currentBalance) => { return (currentBalance || 0) + 200; });
    }

    window.copyRef = () => {
        navigator.clipboard.writeText(document.getElementById('my-ref-code').innerText);
        alert("‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    // Support Function
    window.openSupport = (type) => {
        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶ì ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¶‡¶ø‡¶®
        if(type === 'wa') window.location.href = 'https://wa.me/+910000000000'; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®
        if(type === 'tg') window.location.href = 'https://t.me/yourusername'; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ
    }

    // --- PLANS & INVESTMENT LOGIC ---
    const plans = [
        { id:1, price: 1000, daily: 50, desc: "Basic Plan" },
        { id:2, price: 2000, daily: 110, desc: "Standard Plan" },
        { id:3, price: 5000, daily: 300, desc: "Silver Plan" },
        { id:4, price: 10000, daily: 650, desc: "Gold Plan" },
        { id:5, price: 25000, daily: 1700, desc: "Platinum Plan" },
        { id:6, price: 50000, daily: 3500, desc: "Diamond Plan" },
        { id:7, price: 100000, daily: 7500, desc: "Partner Plan" }
    ];

    window.renderPlans = () => {
        const c = document.getElementById('plans-container');
        c.innerHTML = "";
        plans.forEach(p => {
            c.innerHTML += `
            <div class="plan-card" onclick="openPlanDetails(${p.id})">
                <div>
                    <h4 style="color:#6c5ce7;">${p.desc}</h4>
                    <h2 style="color:#2d3436;">‚Çπ${p.price}</h2>
                    <small style="color:#aaa;">‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</small>
                </div>
                <div style="text-align:right;">
                    <p style="color:green; font-weight:bold;">+‚Çπ${p.daily}/Day</p>
                    <button style="padding:5px 15px; margin-top:5px; font-size:12px;">Details</button>
                </div>
            </div>`;
        });
    }

    window.openPlanDetails = (id) => {
        const plan = plans.find(p => p.id === id);
        selectedPlan = plan;
        document.getElementById('m-price').innerText = "‚Çπ" + plan.price;
        document.getElementById('m-daily').innerText = "‚Çπ" + plan.daily;
        document.getElementById('plan-modal').style.display = 'flex';
    }

    window.closeModal = () => { document.getElementById('plan-modal').style.display = 'none'; selectedPlan = null; }

    window.confirmBuy = () => {
        if(!selectedPlan) return;
        if(userData.balance < selectedPlan.price) {
            alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶®‡ßá‡¶á‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            return;
        }
        const newBal = userData.balance - selectedPlan.price;
        
        // Calculate Expiry Date (Now + 30 Days)
        const expiryDate = new Date();
        expiryDate.setDate(expiryDate.getDate() + 30);

        update(ref(db, 'users/'+currentUser), { balance: newBal });
        
        push(ref(db, 'users/'+currentUser+'/investments'), {
            planName: selectedPlan.desc,
            amount: selectedPlan.price,
            dailyProfit: selectedPlan.daily,
            lastClaim: '',
            purchaseDate: new Date().toDateString(),
            expiryDate: expiryDate.toISOString(), // Store exact expiry time
            principalReturned: false
        });
        alert("‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡ßá‡¶®‡¶æ ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡ß©‡ß¶ ‡¶¶‡¶ø‡¶® ‡¶™‡¶∞ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¶‡ßç‡¶¨‡¶ø‡¶ó‡ßÅ‡¶£ ‡¶ü‡¶æ‡¶ï‡¶æ (Double) ‡¶´‡ßá‡¶∞‡¶§ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§");
        closeModal();
        navTo('home');
    }

    window.claimBonus = () => {
        if(!userData.hasDeposited) {
            alert("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶°‡ßá‡¶á‡¶≤‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
            return;
        }
        const t = new Date().toDateString();
        if(userData.lastBonus === t) return alert("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        update(ref(db, 'users/'+currentUser), { balance: userData.balance + 10, lastBonus: t });
        alert("‡ßß‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    window.claimProfit = (key, daily) => {
        // --- RESTRICTION: CHECK IF DEPOSITED ---
        if(!userData.hasDeposited) {
            alert("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶≤‡¶æ‡¶≠ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
            return;
        }
        // ---------------------------------------

        const today = new Date().toDateString();
        update(ref(db, 'users/'+currentUser+'/investments/'+key), { lastClaim: today });
        update(ref(db, 'users/'+currentUser), { balance: userData.balance + daily });
        alert("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶æ‡¶≠ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    function loadInvestments(d) {
        const div = document.getElementById('active-investments'); 
        div.innerHTML = "";
        if(!d) { div.innerHTML = "<p style='text-align:center; color:#aaa;'>‡¶ñ‡¶æ‡¶≤‡¶ø</p>"; return; }
        
        const today = new Date().toDateString();
        const now = new Date();

        Object.keys(d).forEach(k => {
            const i = d[k];
            const isClaimedToday = i.lastClaim === today;
            const expiry = new Date(i.expiryDate);
            const isExpired = now >= expiry;

            // --- DOUBLE RETURN LOGIC ---
            if (isExpired && i.principalReturned === false) {
                // Return DOUBLE money automatically
                const doubleReturn = i.amount * 2;
                update(ref(db, 'users/'+currentUser+'/investments/'+k), { principalReturned: true });
                update(ref(db, 'users/'+currentUser), { balance: userData.balance + doubleReturn });
                alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑! ‡¶¶‡ßç‡¶¨‡¶ø‡¶ó‡ßÅ‡¶£ ‡¶ü‡¶æ‡¶ï‡¶æ (‚Çπ"+doubleReturn+") ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            }
            // ---------------------------

            let statusHTML = "";
            if(isExpired) {
                statusHTML = `<span style="color:#e74c3c; font-weight:bold;">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶∂‡ßá‡¶∑ (Unlocked)</span>`;
            } else {
                statusHTML = `<span style="color:#f39c12; font-weight:bold;">Locked (Active)</span>`;
            }

            div.innerHTML += `
            <div class="card" style="border-left:5px solid ${isExpired ? '#e74c3c' : '#6c5ce7'};">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <b>${i.planName || 'Investment'}</b><br>
                        <small>Invest: ‚Çπ${i.amount}</small><br>
                        <small style="font-size:10px;">Status: ${statusHTML}</small>
                    </div>
                    <div style="text-align:right;">
                        <span style="color:green; font-weight:bold;">+‚Çπ${i.dailyProfit}</span><br>
                        ${!isExpired ? `
                        <button onclick="claimProfit('${k}', ${i.dailyProfit})" 
                            style="padding:5px 10px; font-size:11px; width:auto; margin-top:5px; background:${isClaimedToday ? '#95a5a6' : '#f39c12'}" 
                            ${isClaimedToday ? 'disabled' : ''}>
                            ${isClaimedToday ? 'Claimed' : 'Claim Profit'}
                        </button>` : ''}
                    </div>
                </div>
            </div>`;
        });
        window.claimProfit = claimProfit;
    }

    window.payNow = () => {
        const amt = document.getElementById('dep-amount').value;
        if(amt) window.location.href = `upi://pay?pa=yourupi@upi&pn=App&am=${amt}&cu=INR`;
    }
    window.submitDeposit = () => {
        const amt = parseInt(document.getElementById('dep-amount').value);
        const utr = document.getElementById('dep-utr').value;
        if(!amt || !utr) return alert("‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
        push(ref(db, 'deposits'), { user: currentUser, amount: amt, utr: utr, status: 'pending' });
        alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); navTo('home');
    }
    window.submitWithdraw = () => {
        const amt = parseInt(document.getElementById('with-amount').value);
        const upi = document.getElementById('with-upi').value;
        if(!amt || !upi) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
        if(amt < 100) return alert("‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ");
        if(amt > userData.balance) return alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á");
        update(ref(db, 'users/' + currentUser), { balance: userData.balance - amt });
        push(ref(db, 'withdrawals'), { user: currentUser, amount: amt, upi: upi, status: 'pending' });
        alert("‡¶∏‡¶´‡¶≤! ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá‡•§");
        document.getElementById('with-amount').value = "";
    }

    window.navTo = (id, elm) => {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(elm) elm.classList.add('active');
    }
</script>
</body>
</html>